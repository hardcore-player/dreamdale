"use strict";var sa={},saPara={name:"sensors",server_url:"",send_timeout:1e3,use_client_time:!1,show_log:!1,login_id_key:"$identity_login_id",allow_amend_share_path:!0,max_string_length:500,datasend_timeout:3e3,source_channel:[],autoTrack:{appLaunch:!0,appShow:!0,appHide:!0},is_persistent_save:{share:!1,utm:!1},batch_send:!0,storage_store_key:"sensorsdata2015_wechat",storage_prepare_data_key:"sensors_mp_prepare_data"};function log(){if(saPara.show_log&&"object"==typeof console&&console.log)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}var nativeIsArray=Array.isArray,ObjProto=Object.prototype,ArrayProto=Array.prototype,nativeForEach=ArrayProto.forEach,nativeIndexOf=ArrayProto.indexOf,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,slice=ArrayProto.slice;function each(e,t,i){if(null==e)return!1;var r={};if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,i);else if(e.length===+e.length){for(var s=0,a=e.length;s<a;s++)if(s in e&&t.call(i,e[s],s,e)===r)return!1}else for(var n in e)if(hasOwnProperty.call(e,n)&&t.call(i,e[n],n,e)===r)return!1}function isObject(e){return null!=e&&"[object Object]"==toString.call(e)}var getRandomBasic=function(){var t=(new Date).getTime();return function(e){return Math.ceil((t=(9301*t+49297)%233280)/233280*e)}}();function getRandom(){if("function"==typeof Uint32Array){var e,t="";if("undefined"!=typeof crypto?t=crypto:"undefined"!=typeof msCrypto&&(t=msCrypto),isObject(t)&&t.getRandomValues)return e=new Uint32Array(1),t.getRandomValues(e)[0]/Math.pow(2,32)}return getRandomBasic(1e19)/1e19}function extend(i){return each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(i[t]=e[t])}),i}function extend2Lev(i){return each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&null!==e[t]&&(isObject(e[t])&&isObject(i[t])?extend(i[t],e[t]):i[t]=e[t])}),i}function coverExtend(i){return each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&void 0===i[t]&&(i[t]=e[t])}),i}var isArray=nativeIsArray||function(e){return"[object Array]"===toString.call(e)};function isFunction(e){return!!e&&("[object Function]"==(e=Object.prototype.toString.call(e))||"[object AsyncFunction]"==e)}function isArguments(e){return!(!e||!hasOwnProperty.call(e,"callee"))}function toArray(e){return e?e.toArray?e.toArray():isArray(e)||isArguments(e)?slice.call(e):values(e):[]}function values(e){var t=[];return null!=e&&each(e,function(e){t[t.length]=e}),t}function include(e,t){var i=!1;if(null!=e){if(nativeIndexOf&&e.indexOf===nativeIndexOf)return-1!=e.indexOf(t);each(e,function(e){if(i=i||e===t)return{}})}return i}function trim(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function isEmptyObject(e){if(isObject(e)){for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0}return!1}function deepCopy(e){var t={};return function e(t,i){for(var r in i){var s=i[r];isArray(s)?(t[r]=[],e(t[r],s)):isObject(s)?(t[r]={},e(t[r],s)):t[r]=s}}(t,e),t}function isUndefined(e){return void 0===e}function isString(e){return"[object String]"==toString.call(e)}function isDate(e){return"[object Date]"==toString.call(e)}function isBoolean(e){return"[object Boolean]"==toString.call(e)}function isNumber(e){return"[object Number]"==toString.call(e)&&/[\d\\.]+/.test(String(e))}function isJSONString(e){try{JSON.parse(e)}catch(e){return!1}return!0}var isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},isSafeInteger=Number.isSafeInteger||function(e){return isInteger(e)&&Math.abs(e)<=Math.pow(2,53)-1},urlSafeBase64={ENC:{"+":"-","/":"_","=":"."},DEC:{"-":"+",_:"/",".":"="},encode:function(e){return e.replace(/[+/=]/g,function(e){return urlSafeBase64.ENC[e]})},decode:function(e){return e.replace(/[-_.]/g,function(e){return urlSafeBase64.DEC[e]})},trim:function(e){return e.replace(/[.=]{1,2}$/,"")},isBase64:function(e){return/^[A-Za-z0-9+/]*[=]{0,2}$/.test(e)},isUrlSafeBase64:function(e){return/^[A-Za-z0-9_-]*[.]{0,2}$/.test(e)}},SOURCE_CHANNEL_STANDARD="utm_source utm_medium utm_campaign utm_content utm_term",LATEST_SOURCE_CHANNEL=["$latest_utm_source","$latest_utm_medium","$latest_utm_campaign","$latest_utm_content","$latest_utm_term","$latest_sa_utm"],LATEST_SHARE_INFO=["$latest_share_distinct_id","$latest_share_url_path","$latest_share_depth","$latest_share_method"],SHARE_INFO_KEY=["sensors_share_d","sensors_share_p","sensors_share_i","sensors_share_m"],MP_FILTER_HOOK={data:1,onLoad:1,onShow:1,onReady:1,onPullDownRefresh:1,onShareAppMessage:1,onShareTimeline:1,onReachBottom:1,onPageScroll:1,onResize:1,onTabItemTap:1,onHide:1,onUnload:1},IDENTITY_KEY={EMAIL:"$identity_email",MOBILE:"$identity_mobile",LOGIN:"$identity_login_id"},LIB_VERSION="1.18.2",LIB_NAME="MiniProgram",meta={init_status:!1,life_state:{app_launched:!1},plugin:{init_list:[],uninitialized_list:[]},privacy:{enable_data_collect:!1},initialState:{queue:[],isComplete:!1},preset_properties:{$lib:LIB_NAME,$lib_version:LIB_VERSION},promise_list:[],query_share_depth:0,page_show_time:Date.now(),mp_show_time:null,share_distinct_id:"",share_method:"",current_scene:"",is_first_launch:!1,wx_sdk_version:"",global_title:{}};function getAppInfoSync(){var e;return wx.getAccountInfoSync?{appId:(e=(e=wx.getAccountInfoSync())&&e.miniProgram?e.miniProgram:{}).appId,appEnv:e.envVersion,appVersion:e.version}:{}}function getAppId(){var e=getAppInfoSync();return e&&e.appId?e.appId:""}function getOpenidNameByAppid(){var e=getAppId();return e?"$identity_mp_"+e+"_openid":"$identity_mp_openid"}function rot13defs(e){return rot13obfs(e=String(e),113)}function rot13obfs(e,t){t="number"==typeof t?t:13;for(var i=(e=String(e)).split(""),r=0,s=i.length;r<s;r++)i[r].charCodeAt(0)<126&&(i[r]=String.fromCharCode((i[r].charCodeAt(0)+t)%126));return i.join("")}var hasOwnProperty$1=Object.prototype.hasOwnProperty,store={storageInfo:null,store_queue:[],getUUID:function(){return Date.now()+"-"+Math.floor(1e7*getRandom())+"-"+getRandom().toString(16).replace(".","")+"-"+String(31242*getRandom()).replace(".","").slice(0,8)},getStorage:function(){return this.storageInfo||(this.storageInfo=sa._.getStorageSync(saPara.storage_store_key)||"",this.storageInfo)},_state:{},mem:{mdata:[],getLength:function(){return this.mdata.length},add:function(e){this.mdata.push(e)},clear:function(e){this.mdata.splice(0,e)}},toState:function(e){var t=null,i=this;function r(){t.distinct_id?i._state=t:i.set("distinct_id",i.getUUID())}isJSONString(e)?(t=JSON.parse(e),r()):isObject(e)?(t=e,r()):this.set("distinct_id",this.getUUID());var s,e=this._state._first_id||this._state.first_id,a=this._state._distinct_id||this._state.distinct_id,n=this._state.openid,o=(this._state.history_login_id||{}).name,c=(this._state.identities&&isString(this._state.identities)&&(c=JSON.parse(rot13defs(this._state.identities)),this._state.identities=c),getOpenidNameByAppid());function u(e){for(var t in store._state.identities)hasOwnProperty$1.call(store._state.identities,t)&&"$identity_mp_id"!==t&&t!==e&&delete store._state.identities[t]}this._state.identities&&isObject(this._state.identities)&&!isEmptyObject(this._state.identities)?(s=(s=getAppId())?"$mp_"+s+"_openid":"$mp_openid",hasOwnProperty$1.call(this._state.identities,"$mp_id")&&(this._state.identities.$identity_mp_id=this._state.identities.$mp_id,delete this._state.identities.$mp_id),hasOwnProperty$1.call(this._state.identities,"$mp_unionid")&&(this._state.identities.$identity_mp_unionid=this._state.identities.$mp_unionid,delete this._state.identities.$mp_unionid),hasOwnProperty$1.call(this._state.identities,s)&&(this._state.identities[c]=this._state.identities[s],delete this._state.identities[s]),hasOwnProperty$1.call(this._state.identities,"$identity_anonymous_id")&&(this._state.identities.$identity_anonymous_id=e||a)):(this._state.identities={},this._state.identities.$identity_mp_id=this.getUUID(),this._state.identities.$identity_anonymous_id=e||a),n&&(this._state.identities[c]=n),e?o&&hasOwnProperty$1.call(this._state.identities,o)?this._state.identities[o]!==a&&(this._state.identities[o]=a,u(o),this._state.history_login_id.value=a):(this._state.identities[IDENTITY_KEY.LOGIN]=a,u(IDENTITY_KEY.LOGIN),this._state.history_login_id={name:IDENTITY_KEY.LOGIN,value:a}):((hasOwnProperty$1.call(this._state.identities,"$identity_login_id")||hasOwnProperty$1.call(this._state.identities,o))&&u("$identity_anonymous_id"),this._state.history_login_id={name:"",value:""}),this.save()},getFirstId:function(){return this._state._first_id||this._state.first_id},getDistinctId:function(){var e=this.getLoginDistinctId();return e||this._state._distinct_id||this._state.distinct_id},getUnionId:function(){var e={},t=this._state._first_id||this._state.first_id,i=this.getDistinctId();return t&&i?(e.login_id=i,e.anonymous_id=t):e.anonymous_id=i,e},getHistoryLoginId:function(){return isObject(this._state.history_login_id)?this._state.history_login_id:null},getLoginDistinctId:function(){var e=this.getHistoryLoginId();return isObject(e)&&e.value?e.name!==IDENTITY_KEY.LOGIN?e.name+"+"+e.value:e.value:null},getProps:function(){return this._state.props||{}},setProps:function(e,t){var i=this._state.props||{};t?this.set("props",e):(extend(i,e),this.set("props",i))},set:function(e,t){var i,r={};for(i in"string"==typeof e?r[e]=t:"object"==typeof e&&(r=e),this._state=this._state||{},r)this._state[i]=r[i],"first_id"===i?delete this._state._first_id:"distinct_id"===i&&(delete this._state._distinct_id,sa.events.emit("changeDistinctId"));this.save()},identitiesSet:function(e){var t={};switch(e.type){case"login":t.$identity_mp_id=this._state.identities.$identity_mp_id,t[e.id_name]=e.id;break;case"logout":t.$identity_mp_id=this._state.identities.$identity_mp_id;break;case"identify":(t=deepCopy(this._state.identities)).$identity_anonymous_id=e.id}this.set("identities",t)},change:function(e,t){this._state["_"+e]=t},encryptStorage:function(){var e=this.getStorage(),t="data:enc;";isObject(e)?e=t+rot13obfs(JSON.stringify(e)):isString(e)&&-1===e.indexOf(t)&&(e=t+rot13obfs(e)),sa._.setStorageSync(saPara.storage_store_key,e)},save:function(){var e=deepCopy(this._state),t=rot13obfs(JSON.stringify(e.identities));e.identities=t,delete e._first_id,delete e._distinct_id,saPara.encrypt_storage&&(e="data:enc;"+rot13obfs(JSON.stringify(e))),sa._.setStorageSync(saPara.storage_store_key,e)},init:function(){var e=this.getStorage(),t="data:enc;";e?(isString(e)&&-1!==e.indexOf(t)&&(e=e.substring(t.length),e=JSON.parse(rot13defs(e))),this.toState(e)):(meta.is_first_launch=!0,e=(t=new Date).getTime(),t.setHours(23),t.setMinutes(59),t.setSeconds(60),this.set({distinct_id:store.getUUID(),first_visit_time:e,first_visit_day_time:t.getTime(),identities:{$identity_mp_id:store.getUUID()},history_login_id:{name:"",value:""}})),this.checkStoreInit()},checkStoreInit:function(){meta.init_status&&(0<this.store_queue.length&&each(this.store_queue,function(e){sa[e.method].apply(sa,slice.call(e.params))}),this.store_queue=[])}};function registerApp(e){isObject(e)&&!isEmptyObject(e)&&(meta.preset_properties=extend(meta.preset_properties,e))}function register(e){isObject(e)&&!isEmptyObject(e)&&store.setProps(e)}function clearAllRegister(){store.setProps({},!0)}function clearAppRegister(i){isArray(i)&&each(meta.preset_properties,function(e,t){include(i,t)&&delete meta.preset_properties[t]})}function clearAllProps(i){var e=store.getProps(),r={};isArray(i)&&(each(e,function(e,t){include(i,t)||(r[t]=e)}),store.setProps(r,!0))}function _decodeURIComponent(t){var i="";try{i=decodeURIComponent(t)}catch(e){i=t}return i}var hasOwnProperty$2=Object.prototype.hasOwnProperty,decodeURIComponent$1=_decodeURIComponent;function encodeDates(i){return each(i,function(e,t){isDate(e)?i[t]=formatDate(e):isObject(e)&&(i[t]=encodeDates(e))}),i}function formatDate(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}function searchObjDate(i){isObject(i)&&each(i,function(e,t){isObject(e)?searchObjDate(i[t]):isDate(e)&&(i[t]=formatDate(e))})}function formatString(e){return e.length>saPara.max_string_length?(log("字符串长度超过限制，已经做截取--"+e),e.slice(0,saPara.max_string_length)):e}function searchObjString(i){isObject(i)&&each(i,function(e,t){isObject(e)?searchObjString(i[t]):isString(e)&&(i[t]=formatString(e))})}function parseSuperProperties(i){isObject(i)&&each(i,function(e,t){if(isFunction(e))try{i[t]=e(),isFunction(i[t])&&(log("您的属性- "+t+" 格式不满足要求，我们已经将其删除"),delete i[t])}catch(e){delete i[t],log("您的属性- "+t+" 抛出了异常，我们已经将其删除")}})}function unique(e){for(var t,i=[],r={},s=0;s<e.length;s++)(t=e[s])in r||(r[t]=!0,i.push(t));return i}var check={checkKeyword:function(e){return/^((?!^distinct_id$|^original_id$|^device_id$|^time$|^properties$|^id$|^first_id$|^second_id$|^users$|^events$|^event$|^user_id$|^date$|^datetime$|^user_group|^user_tag)[a-zA-Z_$][a-zA-Z\d_$]{0,99})$/i.test(e)},checkIdLength:function(e){return!(255<String(e).length)||(log("id 长度超过 255 个字符！"),!1)}};function strip_sa_properties(e){return isObject(e)&&each(e,function(t,r){var s,a;"param"!==r&&"custom"!==r||(isArray(t)?isArray(t)&&1<t.length&&(s=t[0],a=[],each(t,function(e){var i=!0;each(e,function(e,t){s[t]||(i=!1)}),i?a.push(e):sdLog("您的数据-",r,t,"的数组里的对象结果必须相同,已经将不一致数据删除")}),e[r]=a):(delete e[r],sdLog("您的数据-",r,t,"的结构必须是数组，已删除此数据")))}),e}function strip_empty_properties(e){var i={};return each(e,function(e,t){null==e&&void 0===e||(i[t]=e)}),i}function utf8Encode(e){for(var t,i="",r=t=0,s=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,a=0;a<s;a++){var n=e.charCodeAt(a),o=null;n<128?t++:o=127<n&&n<2048?String.fromCharCode(n>>6|192,63&n|128):String.fromCharCode(n>>12|224,n>>6&63|128,63&n|128),null!==o&&(r<t&&(i+=e.substring(r,t)),i+=o,r=t=a+1)}return r<t&&(i+=e.substring(r,e.length)),i}function base64Encode(e){var t,i,r,s,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=0,o=0,c="",u=[];if(!e)return e;for(e=utf8Encode(e);t=(s=e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<8|e.charCodeAt(n++))>>12&63,i=s>>6&63,r=63&s,u[o++]=a.charAt(s>>18&63)+a.charAt(t)+a.charAt(i)+a.charAt(r),n<e.length;);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}function btoa(e){for(var t,i,r,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",n=0,o=(e=String(e)).length%3;n<e.length;)(255<(t=e.charCodeAt(n++))||255<(i=e.charCodeAt(n++))||255<(r=e.charCodeAt(n++)))&&log("Failed to execute 'btoa' : The string to be encoded contains characters outside of the Latin1 range."),a+=s.charAt((t=t<<16|i<<8|r)>>18&63)+s.charAt(t>>12&63)+s.charAt(t>>6&63)+s.charAt(63&t);return o?a.slice(0,o-3)+"===".substring(o):a}function urlBase64Encode(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}function getIsFirstDay(){return!!("object"==typeof store._state&&isNumber(store._state.first_visit_day_time)&&store._state.first_visit_day_time>(new Date).getTime())}function getCurrentUrl(e){var t=getCurrentPath(),i="";return isObject(e)&&e.sensors_mp_encode_url_query&&(i=e.sensors_mp_encode_url_query),t?i?t+"?"+i:t:"未取到"}function getPath(e){return e=isString(e)?e.replace(/^\//,""):"取值异常"}function getCustomUtmFromQuery(e,t,i,r){if(!isObject(e))return{};var s={};if(e.sa_utm)for(var a in e)"sa_utm"===a?s[r+a]=e[a]:include(saPara.source_channel,a)&&(s[i+a]=e[a]);else for(var n in e)-1!==(" "+SOURCE_CHANNEL_STANDARD+" ").indexOf(" "+n+" ")?s[t+n]=e[n]:include(saPara.source_channel,n)&&(s[i+n]=e[n]);return s}function getObjFromQuery(e){var t,e=e.split("?"),i={};return e&&e[1]?(each(e[1].split("&"),function(e){(t=e.split("="))[0]&&t[1]&&(i[t[0]]=t[1])}),i):{}}function setStorageSync(e,t){function i(){e===saPara.storage_prepare_data_key&&isArray(t)&&0==t.length?wx.removeStorageSync(e):wx.setStorageSync(e,t)}try{i()}catch(e){log("set Storage fail --",e);try{i()}catch(e){log("set Storage fail again --",e)}}}function getStorageSync(e){var t="";try{t=wx.getStorageSync(e)}catch(e){log("getStorage fail")}return t}function getMPScene(e){return isNumber(e)||isString(e)&&""!==e?"wx-"+String(e):"未取到值"}function objToParam(e,t){if(!isObject(e))return log("请传入有效对象"),"";var i,r,s=[];for(i in e)hasOwnProperty$2.call(e,i)&&(void 0===(r=e[i])?s.push(i+"="):(r=t?encodeURIComponent(r):r,s.push(i+"="+r)));return s.join("&")}function delObjectKey(e){if(isObject(e))for(var t=0;t<SHARE_INFO_KEY.length;t++)delete e[SHARE_INFO_KEY[t]];else log("请传入有效对象")}function shareInfoData(e){var t={};return isObject(e.query)&&e.query.sampshare&&isJSONString(t=_decodeURIComponent(e.query.sampshare))?{depth:(t=JSON.parse(t)).d,path:t.p,id:t.i,method:t.m}:{}}function setShareInfo(e,t){var i={},r=store.getDistinctId(),s=store.getFirstId();if(e&&isObject(e.query)){if(isEmptyObject(e=shareInfoData(e)))return{};var a=e.depth,n=e.path,o=e.id,c=e.method}"string"==typeof o?(t.$share_distinct_id=o,meta.share_distinct_id=o,i.$latest_share_distinct_id=o):t.$share_distinct_id="取值异常","number"==typeof a?!meta.share_distinct_id||meta.share_distinct_id!==r&&meta.share_distinct_id!==s?!meta.share_distinct_id||meta.share_distinct_id===r&&meta.share_distinct_id===s?t.$share_depth="-1":(t.$share_depth=a+1,meta.query_share_depth=a+1,i.$latest_share_depth=a+1):(t.$share_depth=a,meta.query_share_depth=a,i.$latest_share_depth=a):t.$share_depth="-1","string"==typeof n?(t.$share_url_path=n,i.$latest_share_url_path=n):t.$share_url_path="取值异常","string"==typeof c?(t.$share_method=c,i.$latest_share_method=c):t.$share_method="取值异常",setLatestShare(i)}function getShareInfo(){var e;return saPara.preset_events.share_info_use_string?objToParam({sensors_share_i:store.getDistinctId()||"取值异常",sensors_share_p:getCurrentPath(),sensors_share_d:meta.query_share_depth,sensors_share_m:meta.share_method},!0):(e=JSON.stringify({i:store.getDistinctId()||"取值异常",p:getCurrentPath(),d:meta.query_share_depth,m:meta.share_method}),"sampshare="+encodeURIComponent(e))}function detectOptionQuery(e){var t;return e&&isObject(e.query)?((t={}).query=extend({},e.query),"string"==typeof t.query.scene&&function(e){var t=["utm_source","utm_content","utm_medium","utm_campaign","utm_term","sa_utm"].concat(saPara.source_channel),t=new RegExp("("+t.join("|")+")%3D","i"),i=Object.keys(e);if(1===i.length&&"scene"===i[0]&&t.test(e.scene))return 1}(t.query)&&(t.scene=t.query.scene,delete t.query.scene),e.query.q&&e.query.scancode_time&&"101"===String(e.scene).slice(0,3)&&(t.q=String(t.query.q),delete t.query.q,delete t.query.scancode_time),t):{}}function getMixedQuery(e){var t,e=detectOptionQuery(e),i=e.scene,r=e.q,s=e.query;for(t in s)s[t]=_decodeURIComponent(s[t]);return i&&extend(s,getObjFromQuery(i=-1!==(i=_decodeURIComponent(i)).indexOf("?")?"?"+i.replace(/\?/g,""):"?"+i)),r&&extend(s,getObjFromQuery(_decodeURIComponent(r))),s}function setUtm(e,t){var i={},e=getMixedQuery(e),r=getCustomUtmFromQuery(e,"$","_","$"),e=getCustomUtmFromQuery(e,"$latest_","_latest_","$latest_");return i.pre1=r,i.pre2=e,extend(t,r),i}function setSfSource(e,t){isEmptyObject(e.query)||e.query&&e.query._sfs&&(t.$sf_source=e.query._sfs,registerApp({$latest_sf_source:t.$sf_source}))}function wxrequest(e){var t;0<=compareSDKVersion(meta.wx_sdk_version,"2.10.0")?(e.timeout=saPara.datasend_timeout,wx.request(e)):(t=wx.request(e),setTimeout(function(){isObject(t)&&isFunction(t.abort)&&t.abort()},saPara.datasend_timeout))}function validId(e){return("string"==typeof e||"number"==typeof e)&&""!==e&&("number"!=typeof e||(e=String(e),/^\d+$/.test(e)))?!!check.checkIdLength(e)&&e:(log("输入 ID 类型错误"),!1)}function compareSDKVersion(e,t){e=e.split("."),t=t.split(".");for(var i=Math.max(e.length,t.length);e.length<i;)e.push("0");for(;t.length<i;)t.push("0");for(var r=0;r<i;r++){var s=parseInt(e[r]),a=parseInt(t[r]);if(a<s)return 1;if(s<a)return-1}return 0}function setUpperCase(e){return isString(e)?e.toLocaleUpperCase():e}function setLatestChannel(e){isEmptyObject(e)||(!function(e,t){var i,r=!1;for(i in t)e[t[i]]&&(r=!0);return r}(e,LATEST_SOURCE_CHANNEL)||(clearAppRegister(LATEST_SOURCE_CHANNEL),clearAllProps(LATEST_SOURCE_CHANNEL)),(saPara.is_persistent_save.utm?register:registerApp)(e))}function setLatestShare(e){(e.$latest_share_depth||e.$latest_share_distinct_id||e.$latest_share_url_path||e.$latest_share_method)&&(clearAppRegister(LATEST_SHARE_INFO),clearAllProps(LATEST_SHARE_INFO),(saPara.is_persistent_save.share?register:registerApp)(e))}function setQuery(e,i){var r;return e&&isObject(e)&&!isEmptyObject(e)?(r=[],each(e,function(e,t){"q"===t&&isString(e)&&0===e.indexOf("http")||(i?r.push(t+"="+e):r.push(t+"="+_decodeURIComponent(e)))}),r.join("&")):""}function isNewLoginId(e,t){return e!==store._state.history_login_id.name||store._state.history_login_id.value!==t}function isSameAndAnonymousID(e){var t=store.getFirstId(),i=store.getDistinctId();return t?e===t:e===i}function isPresetIdKeys(e,t){var i,r=["$identity_anonymous_id"];for(i of r=isArray(t)?r.concat(t):r)if(i===e)return!0;return!1}function encodeTrackData(e){e=base64Encode(e=JSON.stringify(e));return encodeURIComponent(e)}function networkStatusChange(){wx.onNetworkStatusChange(function(e){registerApp({$network_type:e.networkType||""})})}function getNetworkType(){return new Promise((t,i)=>{wx.getNetworkType({success:function(e){meta.preset_properties.$network_type=setUpperCase(e.networkType),t()},fail:function(e){log("获取网络信息失败",e),i()}})})}function getSystemInfo(){var s=meta.preset_properties;return new Promise(r=>{wx.getSystemInfo({success:function(e){s.$brand=setUpperCase(e.brand),s.$manufacturer=e.brand,s.$model=e.model,s.$language=e.language,s.$screen_width=Number(e.screenWidth),s.$screen_height=Number(e.screenHeight),s.$os=(i=e.platform,"ios"===(t=i.toLowerCase())?"iOS":"android"===t?"Android":i),s.$os_version=-1<e.system.indexOf(" ")?e.system.split(" ")[1]:e.system,meta.wx_sdk_version=e.SDKVersion,s.$mp_client_app_version=e.version,s.$mp_client_basic_library_version=meta.wx_sdk_version;var t=(new Date).getTimezoneOffset(),i=getAppInfoSync();isNumber(t)&&(s.$timezone_offset=t),i.appId&&(s.$app_id=i.appId),i.appVersion&&(s.$app_version=i.appVersion),r()}})})}var info={currentProps:meta.preset_properties},logger={info:function(){if(saPara.show_log&&"object"==typeof console&&console.log)try{return 3===arguments.length?console.log(arguments[0],arguments[1],arguments[2]):2===arguments.length?console.log(arguments[0],arguments[1]):1===arguments.length?console.log(arguments[0]):void 0}catch(e){console.log(arguments[0])}}};function isValidListener(e){return"function"==typeof e||!(!e||"object"!=typeof e)&&isValidListener(e.listener)}class EventEmitterBase{constructor(){this._events={}}on(e,t){if(!e||!t)return!1;if(isValidListener(t))return this._events[e]=this._events[e]||[],this._events[e].push("object"==typeof t?t:{listener:t,once:!1}),this;throw new Error("listener must be a function")}prepend(e,t){if(!e||!t)return!1;if(isValidListener(t))return this._events[e]=this._events[e]||[],this._events[e].unshift("object"==typeof t?t:{listener:t,once:!1}),this;throw new Error("listener must be a function")}prependOnce(e,t){return this.prepend(e,{listener:t,once:!0})}once(e,t){return this.on(e,{listener:t,once:!0})}off(e,t){var i=this._events[e];if(!i)return!1;if("number"==typeof t)i.splice(t,1);else if("function"==typeof t)for(var r=0,s=i.length;r<s;r++)i[r]&&i[r].listener===t&&i.splice(r,1);return this}emit(e,t){var i=this._events[e];if(!i)return!1;for(var r=0;r<i.length;r++){var s=i[r];s&&(s.listener.call(this,t||{}),s.once&&this.off(e,r))}return this}removeAllListeners(e){e&&this._events[e]?this._events[e]=[]:this._events={}}listeners(e){return e&&"string"==typeof e?this._events[e]:this._events}}class EventEmitterEx extends EventEmitterBase{constructor(){super(),this.cacheEvents=[],this.maxLen=20}replay(t,i){this.on(t,i),0<this.cacheEvents.length&&this.cacheEvents.forEach(function(e){e.type===t&&i.call(null,e.data)})}emit(e,t){super.emit.apply(this,arguments),this.cacheEvents.push({type:e,data:t}),this.cacheEvents.length>this.maxLen&&this.cacheEvents.shift()}}var _=Object.freeze({__proto__:null,decodeURIComponent:decodeURIComponent$1,encodeDates:encodeDates,formatDate:formatDate,searchObjDate:searchObjDate,formatString:formatString,searchObjString:searchObjString,parseSuperProperties:parseSuperProperties,unique:unique,check:check,setQuery:setQuery,setLatestShare:setLatestShare,setLatestChannel:setLatestChannel,setUpperCase:setUpperCase,compareSDKVersion:compareSDKVersion,validId:validId,wxrequest:wxrequest,setUtm:setUtm,getMixedQuery:getMixedQuery,detectOptionQuery:detectOptionQuery,getShareInfo:getShareInfo,setShareInfo:setShareInfo,shareInfoData:shareInfoData,delObjectKey:delObjectKey,objToParam:objToParam,getMPScene:getMPScene,getStorageSync:getStorageSync,setStorageSync:setStorageSync,getObjFromQuery:getObjFromQuery,getCustomUtmFromQuery:getCustomUtmFromQuery,getPath:getPath,getCurrentUrl:getCurrentUrl,getIsFirstDay:getIsFirstDay,urlBase64Encode:urlBase64Encode,btoa:btoa,base64Encode:base64Encode,strip_empty_properties:strip_empty_properties,strip_sa_properties:strip_sa_properties,networkStatusChange:networkStatusChange,getNetworkType:getNetworkType,getSystemInfo:getSystemInfo,encodeTrackData:encodeTrackData,isPresetIdKeys:isPresetIdKeys,isNewLoginId:isNewLoginId,isSameAndAnonymousID:isSameAndAnonymousID,info:info,logger:logger,getAppId:getAppId,getAppInfoSync:getAppInfoSync,getOpenidNameByAppid:getOpenidNameByAppid,rot13defs:rot13defs,rot13obfs:rot13obfs,each:each,isObject:isObject,getRandom:getRandom,extend:extend,extend2Lev:extend2Lev,coverExtend:coverExtend,isArray:isArray,isFunction:isFunction,isArguments:isArguments,toArray:toArray,values:values,include:include,trim:trim,isEmptyObject:isEmptyObject,deepCopy:deepCopy,isUndefined:isUndefined,isString:isString,isDate:isDate,isBoolean:isBoolean,isNumber:isNumber,isJSONString:isJSONString,isInteger:isInteger,isSafeInteger:isSafeInteger,slice:slice,urlSafeBase64:urlSafeBase64,EventEmitterBase:EventEmitterBase,EventEmitterEx:EventEmitterEx,log:log});function onEventSend(){return{}}function processData(e){return e}function batchTrackData(e){var t=Date.now();return e.forEach(function(e){e.time=t}),"data_list="+encodeTrackData(e)}var mergeStorageData={getData:function(t){wx.getStorage({key:saPara.storage_prepare_data_key,complete:function(e){e=e.data&&isArray(e.data)?e.data:[];mergeStorageData.deleteAesData(e),t&&t()}})},deleteAesData:function(e){var t=[],i=e.length;if(0<i){for(var r=0;r<i;r++)isObject(e[r])&&t.push(e[r]);store.mem.mdata=t.concat(store.mem.mdata)}}};function onceTrackData(e){return"data="+encodeTrackData(e)}var kit={},sendStrategy=(kit.processData=processData,kit.onceTrackData=onceTrackData,kit.batchTrackData=batchTrackData,kit.onEventSend=onEventSend,{dataHasSend:!0,dataHasChange:!1,syncStorage:!1,failTime:0,init:function(){this.sendHasInit=!0,mergeStorageData.getData(sendStrategy.syncStorageState.bind(sendStrategy)),this.batchInterval(),this.onAppHide()},syncStorageState:function(){this.syncStorage=!0},onAppHide:function(){var e=this;wx.onHide(function(){saPara.batch_send&&e.batchSend()})},send:function(e){this.dataHasChange=!0,500<=store.mem.getLength()&&(log("storage data is too large"),store.mem.mdata.shift()),(e=kit.processData(e))&&e.appid&&store.mem.add(e),this.sendAsOver()},sendAsOver:function(){this.sendHasInit&&store.mem.getLength()>=saPara.batch_send.max_length&&this.batchSend()},wxrequest:function(e){var t,i,r;isArray(e.data)&&0<e.data.length?(t=kit.batchTrackData(e.data),i=store.getUUID().replace(/-/g,""),r="POSTX-QP-AppId:"+saPara.appid+"X-QP-Nonce:"+i+"X-QP-Timestamp:"+(new Date).getTime()+(-1<saPara.server_url.indexOf("?")?saPara.server_url.substring(0,saPara.server_url.indexOf("?")):saPara.server_url)+"3c6e0b8a9c15224a8228b9a98ca1531d",sa._.wxrequest({url:saPara.server_url,method:"POST",dataType:"text",header:{nonce:i,signature:r},data:t,success:function(){e.success(e.len)},fail:function(){e.fail()}})):e.success(e.len)},batchSend:function(){var e,t;this.dataHasSend&&0<(t=(e=100<=(e=store.mem.mdata).length?e.slice(0,100):e).length)&&(this.dataHasSend=!1,this.wxrequest({data:e,len:t,success:this.batchRemove.bind(this),fail:this.sendFail.bind(this)}))},sendFail:function(){this.dataHasSend=!0,this.failTime++},batchRemove:function(e){store.mem.clear(e),this.dataHasSend=!0,this.dataHasChange=!0,this.batchWrite(),this.failTime=0},is_first_batch_write:!0,batchWrite:function(){this.dataHasChange&&(this.dataHasChange=!1,this.syncStorage&&sa._.setStorageSync(saPara.storage_prepare_data_key,store.mem.mdata))},batchInterval:function(){var t=this;!function e(){setTimeout(function(){t.batchWrite(),e()},500)}(),function e(){setTimeout(function(){t.batchSend(),e()},saPara.batch_send.send_timeout*Math.pow(2,t.failTime))}()}});function onceSend(e){e.time=Date.now();var e=kit.onceTrackData(e),t=saPara.server_url+"?"+e,e=(-1!==saPara.server_url.indexOf("?")&&(t=saPara.server_url+"&"+e),store.getUUID().replace(/-/g,""));wxrequest({url:t,method:"GET",header:{nonce:e,signature:"POSTX-QP-AppId:"+saPara.appid+"X-QP-Nonce:"+e+"X-QP-Timestamp:"+(new Date).getTime()+(-1<saPara.server_url.indexOf("?")?saPara.server_url.substring(0,saPara.server_url.indexOf("?")):saPara.server_url)+"3c6e0b8a9c15224a8228b9a98ca1531d"}})}function buildData(e,t){var i={distinct_id:sa.store.getDistinctId(),identities:sa.store._state.identities,lib:{$lib:LIB_NAME,$lib_method:"code",$lib_version:LIB_VERSION},properties:{}};return"track_id_unbind"===e.type&&"$UnbindID"===e.event&&(i.identities=deepCopy(e.unbind_value),delete e.unbind_value),isObject(t)||(t={}),extend(i,sa.store.getUnionId(),e),isObject(e.properties)&&!isEmptyObject(e.properties)&&extend(i.properties,e.properties),e.type&&"profile"===e.type.slice(0,7)||(i._track_id=Number(String(getRandom()).slice(2,5)+String(getRandom()).slice(2,4)+String(Date.now()).slice(-4)),i.properties=extend({},meta.preset_properties,sa.store.getProps(),t,i.properties),"track"===e.type&&(i.properties.$is_first_day=getIsFirstDay())),i.properties.$time&&isDate(i.properties.$time)?(i.time=+i.properties.$time,delete i.properties.$time):i.time=+new Date,sa.ee.sdk.emit("createData",i),sa.ee.sdk.emit("beforeBuildCheck",i),sa.ee.data.emit("beforeBuildCheck",i),parseSuperProperties(i.properties),strip_sa_properties(i.properties),searchObjDate(i),searchObjString(i),i}function dataStage(e){if(!saPara.server_url)return!1;if(meta.current_scene&&1154===meta.current_scene&&!sa.para.preset_events.moments_page)return!1;var t=sa._.deepCopy(e),i=buildData(e,kit.onEventSend(t));if("track"===i.type){var r={type:"mp_event",user:{uuid:i.identities.$identity_mp_id},custom:i.properties.custom||[]},e=i.identities.$identity_login_id,t=(e&&(r.user.userid=e),i.identities.$identity_anonymous_id);if(e&&(r.user.openid=t),i.event&&"track"===i.type)switch(extend(r,{appid:saPara.appid,event_id:i.properties.event_id,page_id:i.properties.page_id,lib:"MiniGame",lib_version:"2.0",event_type:i.event,local_time:i.time,track_id:i._track_id,is_first_day:i.$is_first_day,mp_app_id:i.properties.$app_id,common:{timezone:(new Date).getTimezoneOffset()/-60,timezone_offset:i.properties.$timezone_offset,device_brand:i.properties.$brand,device_model:i.properties.$model,os:i.properties.$os,os_version:i.properties.$os_version,client_type:4,screen:i.properties.$screen_width+"*"+i.properties.$screen_height,utm_source:i.properties.$latest_utm_source,utm_term:i.properties.$latest_utm_term,utm_content:i.properties.$latest_utm_content,utm_campaign:i.properties.$latest_utm_campaign,utm_medium:i.properties.$latest_utm_medium,mp_app_version:i.properties.$mp_client_app_version,mp_library_version:i.properties.$mp_client_basic_library_version,network:i.properties.$network_type,traffic_source_type:i.properties.$scene,app_region:i.properties.$language},param:i.properties.param||[]}),extend(r.user,i.properties.user),extend(r.common,i.properties.common),r.event_type){case"$MPLaunch":r.event_type="MPL",extend(r.user,{is_first_time:i.properties.$is_first_time}),r.param[0]={url_query:i.properties.$url_query,share_depth:i.properties.$share_depth};break;case"$MPShow":r.event_type="MPV",r.param[0]={url_path:i.properties.$url_path,url_query:i.properties.$url_query,share_depth:i.properties.$share_depth};break;case"$MPHide":r.event_type="MPQ",r.param[0]={url_query:i.properties.$url_query,event_duration:Math.round(i.properties.event_duration)};break;case"$MPShare":r.event_type="MPSHARE",r.param[0]={url_query:i.properties.$url_query,event_duration:Math.round(i.properties.$event_duration)};break;default:r.event_type=i.event.toUpperCase()}log(r),(i=r)?(sa.events.emit("send",i),sa.para.batch_send?sendStrategy.send(i):onceSend(i)):log("error: 数据异常 "+i)}}function initAppShowHide(){wx.onShow(function(e){var t;meta.life_state.app_launched||(t=wx.getLaunchOptionsSync()||{},sa.autoTrackCustom.appLaunch(t)),sa.autoTrackCustom.appShow(e)}),wx.onHide(function(){sa.autoTrackCustom.appHide()})}function checkAppLaunch(){var e;meta.life_state.app_launched||(e=wx.getLaunchOptionsSync()||{},sa.autoTrackCustom.appLaunch(e))}sa.popupEmitter={attached:function(){return!1}};var eventEmitter=function(){this.sub=[]},eventSub=(eventEmitter.prototype={add:function(e){this.sub.push(e)},emit:function(t,i){this.sub.forEach(function(e){e.on(t,i)})}},function(e){sa.events.add(this),this._events=[],this.handle=e,this.ready=!1}),ee=(eventSub.prototype={on:function(e,t){if(this.ready){if(isFunction(this.handle))try{this.handle(e,t)}catch(e){log(e)}}else this._events.push({event:e,data:t})},isReady:function(){var t=this;t.ready=!0,t._events.forEach(function(e){if(isFunction(t.handle))try{t.handle(e.event,e.data)}catch(e){log(e)}})}},{});function checkPrivacyStatus(){if(meta.init_status)return!0}function apiStaging(){each(["setProfile","setOnceProfile","track","quick","incrementProfile","appendProfile","login","logout","registerApp","register","clearAllRegister","clearAllProps","clearAppRegister","setOpenid","unsetOpenid"],function(e){var t=sa[e];sa[e]=function(){return!!checkPrivacyStatus()&&((!isFunction(sa.getDisabled)||!sa.getDisabled())&&void(meta.initialState.isComplete?t.apply(sa,arguments):meta.initialState.queue.push([e,arguments])))}})}ee.sdk=new EventEmitterEx,ee.data=new EventEmitterEx;var hasOwnProperty$3=Object.prototype.hasOwnProperty;function setProfile(e,t){dataStage({type:"profile_set",properties:e})}function setOnceProfile(e,t){dataStage({type:"profile_set_once",properties:e})}function appendProfile(i,e){if(!isObject(i))return!1;each(i,function(e,t){isString(e)?i[t]=[e]:isArray(e)?i[t]=e:(delete i[t],log("appendProfile属性的值必须是字符串或者数组"))}),dataStage({type:"profile_append",properties:i})}function incrementProfile(e,t){if(!isObject(e))return!1;var i=e;isString(e)&&((e={})[i]=1),dataStage({type:"profile_increment",properties:e})}function track(e,t,i){dataStage({type:"track",event:e,properties:t})}function identify(e,t){var i;return!!checkPrivacyStatus()&&(meta.init_status?void((e=validId(e))&&(i=store.getFirstId(),!0===t?i?store.set("first_id",e):store.set("distinct_id",e):i?store.change("first_id",e):store.change("distinct_id",e),store.identitiesSet({type:"identify",id:e}))):(store.store_queue.push({method:"identify",params:arguments}),!1))}function trackSignup(e,t,i,r){var s,a,n;isObject(e)?(s=e.id,a=e.event_name,n=e.id_name):(s=e,a=t),store.set("distinct_id",s),e=n&&n!==IDENTITY_KEY.LOGIN?n+"+"+s:s,dataStage({original_id:store.getFirstId()||store.getDistinctId(),distinct_id:e,login_id:e,type:"track_signup",event:a,properties:i})}function login(e){var t,i,r;return!!(e=validId(e))&&(!isSameAndAnonymousID(e)&&(t=store.getFirstId(),i=store.getDistinctId(),void(isNewLoginId(r=IDENTITY_KEY.LOGIN,e)&&(store._state.identities[r]=e,store.set("history_login_id",{name:r,value:e}),t||store.set("first_id",i),sa.trackSignup({id:e,event_name:"$SignUp"}),store.identitiesSet({type:"login",id:e,id_name:r})))))}function loginWithKey(e,t){if(!isString(e))return log("Key must be String"),!1;if(!check.checkKeyword(e)&&100<e.length)log("Key ["+e+"] is invalid");else if(!check.checkKeyword(e))return log("Key ["+e+"] is invalid"),!1;var i,r;return isPresetIdKeys(e,["$mp_openid","$identity_mp_openid","$identity_mp_unionid","$mp_unionid","$mp_id","$identity_mp_id"])?(log("Key ["+e+"] is invalid"),!1):!!(t=validId(t))&&(!isSameAndAnonymousID(t)&&(i=store.getFirstId(),r=store.getDistinctId(),void(isNewLoginId(e,t)&&(store._state.identities[e]=t,store.set("history_login_id",{name:e,value:t}),i||store.set("first_id",r),sa.trackSignup({id:t,event_name:"$SignUp",id_name:e}),store.identitiesSet({type:"login",id:t,id_name:e})))))}function getAnonymousID(){if(!isEmptyObject(store._state))return store._state._first_id||store._state.first_id||store._state._distinct_id||store._state.distinct_id;log("请先初始化SDK")}function getUserUUID(){if(!isEmptyObject(store._state))return store._state.identities&&store._state.identities.$identity_mp_id;log("请先初始化SDK")}function getIdentities(){return isEmptyObject(store._state)?(log("请先初始化SDK"),null):store._state.identities||null}function logout(e){var t=store.getFirstId();store.identitiesSet({type:"logout"}),store.set("history_login_id",{name:"",value:""}),t?(store.set("first_id",""),!0===e?store.set("distinct_id",store.getUUID()):store.set("distinct_id",t)):log("没有first_id，logout失败")}function setOpenid(e,t){if(!(e=validId(e)))return!1;if(!checkPrivacyStatus())return!1;if(!meta.init_status)return store.store_queue.push({method:"setOpenid",params:arguments}),!1;t&&log("%c 当前版本 setOpenid 接口 已不支持传入第二个参数","color:#F39C12;font-size: 14px;"),store.set("openid",e),sa.identify(e,!0);t=getOpenidNameByAppid();store._state.identities[t]=e,store.save()}function unsetOpenid(e){e=validId(e);if(!e)return!1;store._state.openid===e&&store.set("openid","");var t=getOpenidNameByAppid();hasOwnProperty$3.call(store._state.identities,t)&&e===store._state.identities[t]&&(delete store._state.identities[t],store.save())}function initWithOpenid(t,i){(t=t||{}).appid&&(saPara.appid=t.appid),sa.openid.getOpenid(function(e){e&&sa.setOpenid(e,t.isCoverLogin),i&&isFunction(i)&&i(e),sa.init(t)})}function quick(){var e=arguments[0],t=arguments[1],i=arguments[2],i=isObject(i)?i:{};if("getAnonymousID"===e){if(!isEmptyObject(store._state))return store._state._first_id||store._state.first_id||store._state._distinct_id||store._state.distinct_id;log("请先初始化SDK")}else"appLaunch"===e||"appShow"===e?t?sa.autoTrackCustom[e](t,i):log("App的launch和show，在sensors.quick第二个参数必须传入App的options参数"):"appHide"===e&&(i=isObject(t)?t:{},sa.autoTrackCustom[e](i))}function appLaunch(e,t){var i={},r=(e&&e.scene?(meta.current_scene=e.scene,i.$scene=getMPScene(e.scene)):i.$scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,delObjectKey(e.query)),e&&e.path&&(i.$url_path=getPath(e.path),i.$title=getPageTitle(e.path)),setShareInfo(e,i),setUtm(e,i));meta.is_first_launch?(i.$is_first_time=!0,isEmptyObject(r.pre1)||sa.setOnceProfile(r.pre1)):i.$is_first_time=!1,setLatestChannel(r.pre2),setSfSource(e,i),sa.registerApp({$latest_scene:i.$scene}),i.$url_query=setQuery(e.query),i.$url=e.path+(i.$url_query?"?"+i.$url_query:""),isObject(t)&&(i=extend(i,t)),sa.track("$MPLaunch",i)}function appShow(e,t){var i={};meta.mp_show_time=(new Date).getTime(),e&&e.scene?(meta.current_scene=e.scene,i.$scene=getMPScene(e.scene)):i.$scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,delObjectKey(e.query)),e&&e.path&&(i.$url_path=getPath(e.path),i.$title=getPageTitle(e.path)),setShareInfo(e,i),setLatestChannel(setUtm(e,i).pre2),setSfSource(e,i),sa.registerApp({$latest_scene:i.$scene}),i.$url_query=setQuery(e.query),e&&e.path&&(i.$url=e.path+(i.$url_query?"?"+i.$url_query:"")),isObject(t)&&(i=extend(i,t)),sa.track("$MPShow",i)}function appHide(e){var t=(new Date).getTime(),i={};i.$url_path=getCurrentPath(),meta.mp_show_time&&0<t-meta.mp_show_time&&(t-meta.mp_show_time)/36e5<24&&(i.event_duration=(t-meta.mp_show_time)/1e3),isObject(e)&&(i=extend(i,e)),sa.track("$MPHide",i),sa.sendStrategy.onAppHide()}function setPara(e){sa.para=extend2Lev(saPara,e);var t=[];if(isArray(saPara.source_channel))for(var i=saPara.source_channel.length,r=0;r<i;r++)-1===" utm_source utm_medium utm_campaign utm_content utm_term sa_utm ".indexOf(" "+saPara.source_channel[r]+" ")&&t.push(saPara.source_channel[r]);saPara.source_channel=t,isObject(saPara.register)&&extend(meta.preset_properties,saPara.register),saPara.openid_url||(saPara.openid_url=saPara.server_url.replace(/([^\\/])\/(sa)(\.gif){0,1}/,"$1/mp_login")),"number"!=typeof saPara.send_timeout&&(saPara.send_timeout=1e3);var s={send_timeout:6e3,max_length:6},e=(e&&e.datasend_timeout||saPara.batch_send&&(saPara.datasend_timeout=1e4),!0===saPara.batch_send?(saPara.batch_send=extend({},s),saPara.use_client_time=!1):isObject(saPara.batch_send)&&(saPara.batch_send=extend({},s,saPara.batch_send),saPara.use_client_time=!0),{share:!1,utm:!1});!0===saPara.is_persistent_save?(saPara.is_persistent_save=extend({},e),saPara.is_persistent_save.utm=!0):isObject(saPara.is_persistent_save)&&(saPara.is_persistent_save=extend({},e,saPara.is_persistent_save)),saPara.server_url||log("请使用 setPara() 方法设置 server_url 数据接收地址")}function getServerUrl(){return saPara.server_url}var autoTrackCustom={trackCustom:function(e,t,i){var r,s=saPara.autoTrack[e];saPara.autoTrack&&s&&("function"==typeof s?isObject(r=s())&&extend(t,r):isObject(s)&&(extend(t,s),saPara.autoTrack[e]=!0),sa.track(i,t))},appLaunch:function(e,t){if(!checkPrivacyStatus())return!1;if(!meta.initialState.isComplete)return meta.initialState.queue.push(["appLaunch",arguments]),!(meta.life_state.app_launched=!0);meta.life_state.app_launched=!0;var i={},r=(e&&e.scene?(meta.current_scene=e.scene,i.$scene=getMPScene(e.scene)):i.$scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,delObjectKey(e.query)),e&&e.path&&(i.$url_path=getPath(e.path),i.$title=getPageTitle(e.path),e.query&&isObject(e.query)&&(r=(r=setQuery(e.query))?"?"+r:"",i.$url=i.$url_path+r)),setShareInfo(e,i),setUtm(e,i));meta.is_first_launch?(i.$is_first_time=!0,isEmptyObject(r.pre1)||sa.setOnceProfile(r.pre1)):i.$is_first_time=!1,setLatestChannel(r.pre2),setSfSource(e,i),sa.registerApp({$latest_scene:i.$scene}),i.$url_query=setQuery(e.query),t?(i=extend(i,t),sa.track("$MPLaunch",i)):saPara.autoTrack&&saPara.autoTrack.appLaunch&&sa.autoTrackCustom.trackCustom("appLaunch",i,"$MPLaunch")},appShow:function(e,t){var i={};meta.mp_show_time=(new Date).getTime(),e&&e.scene?(meta.current_scene=e.scene,i.$scene=getMPScene(e.scene)):i.$scene="未取到值",e&&e.scene&&1010===e.scene&&e.query&&(e.query.sampshare&&delete e.query.sampshare,delObjectKey(e.query)),e&&e.path&&(i.$url_path=getPath(e.path),i.$title=getPageTitle(e.path)),setShareInfo(e,i),setLatestChannel(setUtm(e,i).pre2),setSfSource(e,i),sa.registerApp({$latest_scene:i.$scene}),i.$url_query=setQuery(e.query),e&&e.path&&(i.$url=e.path+(i.$url_query?"?"+i.$url_query:"")),t?(i=extend(i,t),sa.track("$MPShow",i)):saPara.autoTrack&&saPara.autoTrack.appShow&&sa.autoTrackCustom.trackCustom("appShow",i,"$MPShow")},appHide:function(e){var t=(new Date).getTime(),i={};meta.mp_show_time&&0<t-meta.mp_show_time&&(t-meta.mp_show_time)/36e5<24&&(i.event_duration=(t-meta.mp_show_time)/1e3),e?(i=extend(i,e),sa.track("$MPHide",i)):saPara.autoTrack&&saPara.autoTrack.appHide&&sa.autoTrackCustom.trackCustom("appHide",i,"$MPHide")},pageLoad:function(e){meta.current_scene&&1010===meta.current_scene&&e&&(e.sampshare&&delete e.sampshare,delObjectKey(e)),e&&isObject(e)&&(this.sensors_mp_url_query=setQuery(e),this.sensors_mp_encode_url_query=setQuery(e,!0))}},openid={getRequest:function(t){wx.login({success:function(e){e.code&&saPara.appid&&saPara.openid_url?wxrequest({url:saPara.openid_url+"&code="+e.code+"&appid="+saPara.appid,method:"GET",complete:function(e){isObject(e)&&isObject(e.data)&&e.data.openid?t(e.data.openid):t()}}):t()}})},getWXStorage:function(){var e=store.getStorage();if(e&&isObject(e))return e.openid},getOpenid:function(e){if(!saPara.appid)return e(),!1;var t=this.getWXStorage();t?e(t):this.getRequest(e)}},functions=Object.freeze({__proto__:null,setProfile:setProfile,setOnceProfile:setOnceProfile,appendProfile:appendProfile,incrementProfile:incrementProfile,track:track,identify:identify,trackSignup:trackSignup,login:login,loginWithKey:loginWithKey,getAnonymousID:getAnonymousID,getUserUUID:getUserUUID,getIdentities:getIdentities,logout:logout,setOpenid:setOpenid,unsetOpenid:unsetOpenid,initWithOpenid:initWithOpenid,quick:quick,appLaunch:appLaunch,appShow:appShow,appHide:appHide,setPara:setPara,getServerUrl:getServerUrl,openid:openid,autoTrackCustom:autoTrackCustom,registerApp:registerApp,register:register,clearAllRegister:clearAllRegister,clearAppRegister:clearAppRegister,clearAllProps:clearAllProps});function buildAPI(e){for(var t in functions)e[t]=functions[t]}function setFirstVisitTime(){meta.is_first_launch&&setOnceProfile({$first_visit_time:new Date})}function checkIsComplete(){meta.initialState.isComplete=!0,0<meta.initialState.queue.length&&(each(meta.initialState.queue,function(e){"appLaunch"===e[0]?sa.autoTrackCustom.appLaunch.apply(sa.autoTrackCustom,slice.call(e[1])):sa[e[0]].apply(sa,slice.call(e[1]))}),meta.initialState.queue=[])}function init(e){if(!0===meta.init_status)return!1;function t(){checkIsComplete(),checkAppLaunch(),sa.ee.sdk.emit("ready")}meta.init_status=!0,sa.ee.sdk.emit("beforeInit"),e&&isObject(e)&&sa.setPara(e),sa.ee.sdk.emit("initPara"),sa.ee.sdk.emit("afterInitPara"),sa.store.init(),setFirstVisitTime(),sa.para.batch_send&&sendStrategy.init();e=[getNetworkType(),getSystemInfo()].concat(meta.promise_list);Promise.all(e).then(()=>{t()}).catch(()=>{t()})}sa._=_,sa.modules={},sa.meta=meta,sa.kit=kit,sa.mergeStorageData=mergeStorageData,sa.dataStage=dataStage,sa.sendStrategy=sendStrategy,sa.store=store,sa.eventSub=eventSub,sa.events=new eventEmitter,sa.ee=ee,sa.initialState=meta.initialState,sa.IDENTITY_KEY={EMAIL:IDENTITY_KEY.EMAIL,MOBILE:IDENTITY_KEY.MOBILE},buildAPI(sa),apiStaging();try{networkStatusChange(),initAppShowHide()}catch(e){log(e)}sa.init=init,module.exports=sa;